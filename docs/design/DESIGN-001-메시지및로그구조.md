# DESIGN-001-메시지및로그구조

## 목적
DevTalk에서는 단순한 채팅 기록이 아니라,  
문제 해결 과정과 판단의 흐름을 다시 재구성할 수 있는 로그로 남기기 위해  
메시지와 로그 구조를 정의한다.

본 구조는 성공뿐만 아니라 실패 과정까지 기록 자산으로 남기는 것을 목표로 한다.

## 내용

### Session
- Session은 단순한 채팅방이 아니라, 하나의 문제를 질문하고 해결해 나가는 과정을 기록하는 단위이다.
- 하나의 Session에는 문제와 관련된 여러 Message가 누적된다.
- 문제 해결이 종료되었다고 판단되면, 사용자가 직접 해결 버튼을 통해 Session을 Resolved 상태로 변경한다.
- 생성된 Session에는 메시지가 존재하지 않을 수 있으며, 이 경우 빈 메시지 목록을 가진다.
- 세션 조회시 대화의 흐름을 한번에 확인 할수 있어야 하며 요약은 보조적인 장치로 사용한다. 
- 로그만으로도 문제 해결 과정을 이해 할 수 있어야한다.

### Message
- Message는 하나의 Session 내에서 오가는 기록 단위이다.
- 사용자의 입력과 AI의 응답으로 구성되며, AI 응답이 실패한 경우에도 Message로 기록된다.
- Message는 시간 순서대로 정렬되어 문제 해결의 흐름을 재구성할 수 있어야 한다.

### MessageRole
- USER: 사용자가 입력한 질문, 코드, 시도 내용
- AI: LLM이 생성한 응답 또는 분석 결과  
  MessageRole은 메시지를 발생시킨 주체를 의미한다.

### MessageStatus
- SUCCESS: 메시지가 정상적으로 생성·기록된 상태
- FAILED: LLM 응답 실패 등 오류가 발생했으나, 서버의 전체 처리 흐름은 정상적으로 유지된 상태  
  실패 역시 문제 해결 과정의 일부로 간주하며 기록 대상에 포함한다.

### 로그 메타 정보
모든 Message는 최소한 다음 정보를 포함한다.
- timestamp: 메시지가 생성된 시점
- role: 메시지의 주체
- status: 메시지의 상태
- content: 메시지의 내용

## 결과
위 구조를 통해 다음과 같은 결과를 얻을 수 있다.

1. 문제 해결 과정을 Session 단위로 명확하게 추적할 수 있다.
2. LLM 실패 등 실패 과정 또한 기록되어 자산으로 남는다.
3. 누적된 로그를 분석해 다른 서비스인 문제와르르(로그 기반 블로그 작성)와 연동이 가능하다.
4. 사람이 직접 해결 여부를 판단함으로써, 모든 결정을 AI에 의존하지 않는다.
