# DESIGN-001-메시지및로그구조

## 목적

DevTalk에서는 단순한 채팅 기록이 아니라,  
문제 해결 과정과 판단의 흐름을 다시 재구성할 수 있는 로그로 남기기 위해  
메시지와 로그 구조를 정의한다.

본 구조는 성공뿐만 아니라 실패 과정까지 기록 자산으로 남기는 것을 목표로 한다.

## 내용

### Session

- Session은 단순한 채팅방이 아니라, 하나의 문제를 질문하고 해결해 나가는 과정을 기록하는 단위이다.
- 하나의 Session에는 문제와 관련된 여러 Message가 누적된다.
- 사용자가 더이상 당 사고 흐름을 이어가지 않겠다고 판단하면, 사용자가 직접 해결 버튼을 통해 Session을 Resolved 상태로 변경한다.
- Resolved는 정답에 대한 여부가 아닌 사고 흐름에 대한 판단의 종료를 의미한다.
- 생성된 Session에는 메시지가 존재하지 않을 수 있으며, 이 경우 빈 메시지 목록을 가진다.
- 세션 조회시 대화의 흐름을 한번에 확인 할수 있어야 하며 요약은 보조적인 장치로 사용한다.
- 로그만으로도 문제 해결 과정을 이해 할 수 있어야한다.

### Message

- Message는 하나의 Session 내에서 오가는 기록 단위이다.
- 사용자의 입력과 AI의 응답으로 구성되며, AI 응답이 실패한 경우에도 Message로 기록된다.
- Message는 시간 순서대로 정렬되어 문제 해결의 흐름을 재구성할 수 있어야 한다.
- Message는 독집적으로 "해결된 상태를 가지지 않고" 추가적인 약한 상태를 가진다.

### MessageRole

- USER: 사용자가 입력한 질문, 코드, 시도 내용
- AI: LLM이 생성한 응답 또는 분석 결과  
  MessageRole은 메시지를 발생시킨 주체를 의미한다.

### MessageStatus

- SUCCESS: 메시지가 정상적으로 생성·기록된 상태
- FAILED: LLM 응답 실패 등 오류가 발생했으나, 서버의 전체 처리 흐름은 정상적으로 유지된 상태  
  실패 역시 문제 해결 과정의 일부로 간주하며 기록 대상에 포함한다.
- 이는 문제 해결 여부가 아닌 메세지에 대한 전송 여부를 의미한다.

### MessageMarker (판단 보조 상태)

- Message는 문제 해결 판단의 근거로 사용될 수 있도록,
- 다음과 같은 **약한 의미의 상태(마커)**를 가질 수 있다.
- 예시:
- QUESTION: 질문
- INSIGHT: 문제를 이해하는 데 도움이 된 응답
- ATTEMPT: 해결을 위한 시도
- KEY_POINT: 이후 판단에 중요한 기준이 된 내용
- REFERENCE: 나중에 다시 참고할 가치가 있는 메시지

이 마커들은:

- 자동으로 부여되지 않는다.
- 문제의 해결 여부를 결정하지 않는다.
- 사람이 판단을 정리할 때 참고하기 위한 용도로만 사용된다.

### 로그 메타 정보

모든 Message는 최소한 다음 정보를 포함한다.

- timestamp: 메시지가 생성된 시점
- role: 메시지의 주체
- status: 메시지의 상태
- content: 메시지의 내용

## 결과

위 구조를 통해 다음과 같은 결과를 얻을 수 있다.

1. 사고 흐름의 단위인 Session으로 문제 해결 과정을 기록할 수 있다.
2. LLM 실패 등의 모든 시도가 로그 즉 자산으로 남는다.
3. Resolved는 사람의 판단으로 유지된다.
4. 메세지는 해결 여부를 강제하지 않고 판단의 근거로 활용될 수 있다.
5. 누적된 로그 및 메세지 마커로 이후의 블로그 초안 생성 분석작업으로 이어질 수 있다.
